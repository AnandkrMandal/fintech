{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bluestock | password_reset</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
</head>
<style>
    body {
        font-family: Arial, sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        width: 100vw;
        margin: 0;
    }

    form {
        display: flex;
        flex-direction: column;
    }

    .forgetpass-form {
        width: 100%;
        max-width: 420px;
        background-color: rgba(255, 255, 255, 0.8);
        border-radius: 8px;
        text-align: left;
    }

    .logo {
        width: 230px;
    }

    input[type="email"] {
        padding: 0.625rem;
        border: 1px solid #ccc;
        border-radius: 0.25rem;
        width: 100%;
        box-sizing: border-box;
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.1);
    }

    .captcha {
        display: flex;
        overflow: hidden;
        align-items: start;
        justify-content: start;
        margin-bottom: 1rem;
    }

    .for-btn {
        background-color: #2451b3;
        border-color: #2451b3;
        color: white;
    }

    .for-btn:hover {
        background-color: #5686f7;
        border-color: #5686f7;
    }

    .spinner-border {
        display: none;
    }

    .text {
        font-size: 14px;
    }

    .back-to-login {
        background-color: transparent;
        border: none;
        color: grey;
        cursor: pointer;
    }
</style>

<body>
    <div class="container d-flex align-items-center justify-content-center vh-100">
        <div class="forgetpass-form p-4 shadow rounded">
            <div class="text-center">
                <a class="" href="{% url 'home' %}">
                    <img src="{% static 'assets/logo.png' %}" alt="Bluestock" class="logo mx-auto d-block">
                </a>
                <h4 class="forgot-password mt-2">Forget Password?</h4>
                <div class="text-center text mt-1">Enter Your email address to get the password reset link</div>
            </div>
            <form action="" method="post" class="mt-4" onsubmit="onSubmit(event)" id="login-form">{% csrf_token %}
                <div class="form-group">
                    <label for="email">Email Address</label>
                    <input type="email" id="email" name="email" placeholder="" required />
                </div>
                <button type="submit" class="btn btn-primary btn-block for-btn p-2" onclick="onSubmit()"
                    id="submit-btn">
                    <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                    Send Email
                </button>
                <div id="message" class="mt-3"></div>
            </form>
            <a href="{% url 'userlogin' %}" class="d-block text-center mt-1">back to login</a>
            <script>
                async function onSubmit(event) {
                    event.preventDefault();

                    const email = document.getElementById('email').value;
                    const messageDiv = document.getElementById('message');

                    messageDiv.textContent = '';
                    document.getElementById('submit-btn').disabled = true;
                    document.querySelector('.spinner-border').style.display = 'inline-block';

                    try {
                        const response = await fetch('/api/rest/auth/password/reset/', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                            },
                            body: JSON.stringify({ email: email }),
                        });

                        if (!response.ok) {
                            const errorData = await response.json();
                            throw new Error(errorData.detail || 'An error occurred');
                        }

                        const data = await response.json();
                        messageDiv.textContent = 'Password reset email sent successfully.';
                        messageDiv.classList.add('alert', 'alert-success');
                    } catch (error) {
                        messageDiv.textContent = error.message;
                        messageDiv.classList.add('alert', 'alert-danger');
                    } finally {
                        document.getElementById('submit-btn').disabled = false;
                        document.querySelector('.spinner-border').style.display = 'none';
                    }
                }
            </script>
</body>

</html>